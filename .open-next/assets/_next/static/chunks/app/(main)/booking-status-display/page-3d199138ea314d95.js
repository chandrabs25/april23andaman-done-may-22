(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6610],{5215:function(e,t,n){Promise.resolve().then(n.bind(n,5035))},9376:function(e,t,n){"use strict";var r=n(5475);n.o(r,"useParams")&&n.d(t,{useParams:function(){return r.useParams}}),n.o(r,"usePathname")&&n.d(t,{usePathname:function(){return r.usePathname}}),n.o(r,"useRouter")&&n.d(t,{useRouter:function(){return r.useRouter}}),n.o(r,"useSearchParams")&&n.d(t,{useSearchParams:function(){return r.useSearchParams}})},5035:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return o}});var r=n(7437),a=n(2265),s=n(9376);function i(){let e=(0,s.useRouter)(),t=(0,s.useSearchParams)().get("mtid"),[n,i]=(0,a.useState)("Verifying payment status, please wait..."),[o,c]=(0,a.useState)(!0),[u,l]=(0,a.useState)(null),[m,f]=(0,a.useState)(0),d=(0,a.useRef)(null);return(0,a.useEffect)(()=>{if(!t){i("Invalid payment session. Merchant Transaction ID is missing."),c(!1),l("No transaction ID found in URL.");return}let n=async r=>{c(!0),f(r);try{let a=await fetch("/api/bookings/check-payment-status?mtid=".concat(t));if(!a.ok){let e="Error: ".concat(a.status," ").concat(a.statusText||"Failed to fetch status");try{e=(await a.json()).message||e}catch(e){}i("Failed to verify payment status."),l(e),c(!1),d.current&&clearTimeout(d.current);return}let s=await a.json();s.success?"PAYMENT_SUCCESS"===s.phonePePaymentStatus||"CONFIRMED"===s.bookingStatus?(i("Payment successful! Redirecting to your booking confirmation..."),l(null),c(!1),d.current&&clearTimeout(d.current),d.current=setTimeout(()=>e.push("/booking/confirmation/".concat(t)),2e3)):"PAYMENT_PENDING"===s.phonePePaymentStatus||"PENDING_PAYMENT"===s.bookingStatus?r<5?(i("Payment is pending. Checking again soon... (Attempt ".concat(r+1,"/").concat(5,")")),d.current&&clearTimeout(d.current),d.current=setTimeout(()=>n(r+1),5e3)):(i("Payment is still pending. We will update you once confirmed."),l('Your payment is taking longer than usual to confirm. Please check your email or "My Bookings" section later for updates.'),c(!1)):(i("Payment failed."),l(s.message||"Gateway Status: ".concat(s.phonePePaymentStatus||"Unknown")),c(!1)):(i("Failed to verify payment status."),l(s.message||"Could not retrieve valid payment details from server."),c(!1))}catch(e){console.error("Error checking payment status:",e),i("An error occurred while checking payment status."),l("A network or server error occurred. Please try refreshing or check back later."),c(!1)}};return n(0),()=>{d.current&&clearTimeout(d.current)}},[t,e]),(0,r.jsxs)("div",{style:{padding:"20px",textAlign:"center",fontFamily:"Arial, sans-serif",minHeight:"60vh",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center"},children:[(0,r.jsx)("h1",{style:{fontSize:"2em",marginBottom:"20px",color:"#333"},children:"Payment Status"}),(0,r.jsx)("p",{style:{fontSize:"1.2em",color:"#555",marginBottom:"15px",minHeight:"50px"},children:n}),o&&(0,r.jsx)("p",{style:{color:"#777",fontStyle:"italic"},children:"Loading details..."}),u&&(0,r.jsxs)("div",{style:{marginTop:"20px",padding:"10px",border:"1px solid #ffcccc",backgroundColor:"#fff0f0",borderRadius:"5px",color:"#cc0000"},children:[(0,r.jsx)("strong",{children:"Error Details:"})," ",u]})]})}function o(){return(0,r.jsx)(a.Suspense,{fallback:(0,r.jsxs)("div",{style:{padding:"20px",textAlign:"center",fontFamily:"Arial, sans-serif",minHeight:"60vh",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center"},children:[(0,r.jsx)("h1",{style:{fontSize:"2em",marginBottom:"20px"},children:"Loading Payment Details..."}),(0,r.jsx)("p",{style:{fontStyle:"italic",color:"#777"},children:"Please wait..."})]}),children:(0,r.jsx)(i,{})})}}},function(e){e.O(0,[2971,2117,1744],function(){return e(e.s=5215)}),_N_E=e.O()}]);