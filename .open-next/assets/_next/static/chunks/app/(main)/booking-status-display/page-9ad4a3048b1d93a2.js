(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6610],{8568:function(e,t,n){Promise.resolve().then(n.bind(n,5035))},9763:function(e,t,n){"use strict";n.d(t,{Z:function(){return o}});var r=n(2265),c={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};let a=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase().trim(),o=(e,t)=>{let n=(0,r.forwardRef)((n,o)=>{let{color:s="currentColor",size:u=24,strokeWidth:i=2,absoluteStrokeWidth:l,className:d="",children:f,...m}=n;return(0,r.createElement)("svg",{ref:o,...c,width:u,height:u,stroke:s,strokeWidth:l?24*Number(i)/Number(u):i,className:["lucide","lucide-".concat(a(e)),d].join(" "),...m},[...t.map(e=>{let[t,n]=e;return(0,r.createElement)(t,n)}),...Array.isArray(f)?f:[f]])});return n.displayName="".concat(e),n}},3639:function(e,t,n){"use strict";n.d(t,{Z:function(){return r}});let r=(0,n(9763).Z)("AlertTriangle",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z",key:"c3ski4"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]])},5302:function(e,t,n){"use strict";n.d(t,{Z:function(){return r}});let r=(0,n(9763).Z)("CheckCircle",[["path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14",key:"g774vq"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]])},6362:function(e,t,n){"use strict";n.d(t,{Z:function(){return r}});let r=(0,n(9763).Z)("ExternalLink",[["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}],["polyline",{points:"15 3 21 3 21 9",key:"mznyad"}],["line",{x1:"10",x2:"21",y1:"14",y2:"3",key:"18c3s4"}]])},9637:function(e,t,n){"use strict";n.d(t,{Z:function(){return r}});let r=(0,n(9763).Z)("Home",[["path",{d:"m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z",key:"y5dka4"}],["polyline",{points:"9 22 9 12 15 12 15 22",key:"e2us08"}]])},5863:function(e,t,n){"use strict";n.d(t,{Z:function(){return r}});let r=(0,n(9763).Z)("Loader2",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]])},5131:function(e,t,n){"use strict";n.d(t,{Z:function(){return r}});let r=(0,n(9763).Z)("XCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]])},7648:function(e,t,n){"use strict";n.d(t,{default:function(){return c.a}});var r=n(2972),c=n.n(r)},9376:function(e,t,n){"use strict";var r=n(5475);n.o(r,"useParams")&&n.d(t,{useParams:function(){return r.useParams}}),n.o(r,"usePathname")&&n.d(t,{usePathname:function(){return r.usePathname}}),n.o(r,"useRouter")&&n.d(t,{useRouter:function(){return r.useRouter}}),n.o(r,"useSearchParams")&&n.d(t,{useSearchParams:function(){return r.useSearchParams}})},5035:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return p}});var r=n(7437),c=n(2265),a=n(9376),o=n(7648),s=n(4603),u=n(5863),i=n(5302),l=n(5131),d=n(3639),f=n(6362),m=n(9637),h=n(5960);function g(){let e=(0,a.useRouter)(),t=(0,a.useSearchParams)(),{isAuthenticated:n}=(0,s.a)(),g=t.get("mtid"),[p,x]=(0,c.useState)("Verifying payment status, please wait..."),[y,b]=(0,c.useState)(!0),[w,k]=(0,c.useState)(null),[v,j]=(0,c.useState)(0),P=[{delay:25e3,repeat:1},{delay:3e3,repeat:10},{delay:6e3,repeat:10}],N=P.reduce((e,t)=>e+t.repeat,0),S=(0,c.useRef)(null);(0,c.useEffect)(()=>{if(!g){x("Invalid payment session. Merchant Transaction ID is missing."),b(!1),k("No transaction ID found in URL.");return}let t=async n=>{b(!0),j(n);try{let r=await fetch("/api/bookings/check-payment-status?mtid=".concat(g));if(!r.ok){let e="Error: ".concat(r.status," ").concat(r.statusText||"Failed to fetch status");try{e=(await r.json()).message||e}catch(e){}x("Failed to verify payment status."),k(e),b(!1),S.current&&clearTimeout(S.current);return}let c=await r.json();if(c.success){if("PAYMENT_SUCCESS"===c.phonePePaymentStatus||"CONFIRMED"===c.bookingStatus){x("Payment successful! Redirecting to your booking confirmation..."),k(null),b(!1),S.current&&clearTimeout(S.current);let t=c.bookingId||g;S.current=setTimeout(()=>e.push("/booking/confirmation/".concat(t)),2e3)}else if("PAYMENT_PENDING"===c.phonePePaymentStatus||"PENDING_PAYMENT"===c.bookingStatus){if(n<N-1){x("Payment is pending. Checking again soon... (Attempt ".concat(n+1,"/").concat(N,")"));let e=0,r=6e3;for(let t of P){if(n-e<t.repeat){r=t.delay;break}e+=t.repeat}S.current&&clearTimeout(S.current),S.current=setTimeout(()=>t(n+1),r)}else x("Payment is still pending. We will update you once confirmed."),k('Your payment is taking longer than usual to confirm. Please check your email or "My Bookings" section later for updates.'),b(!1)}else x("Payment failed."),k(c.message||"Gateway Status: ".concat(c.phonePePaymentStatus||"Unknown")),b(!1)}else x("Failed to verify payment status."),k(c.message||"Could not retrieve valid payment details from server."),b(!1)}catch(e){console.error("Error checking payment status:",e),x("An error occurred while checking payment status."),k("A network or server error occurred. Please try refreshing or check back later."),b(!1)}};return t(0),()=>{S.current&&clearTimeout(S.current)}},[g,e]);let A=h.l8,C=h.x7,E=h.O9,M=h.Wx,Z=u.Z;!y&&(p.includes("successful")?(A=h.Bc,C=h.MP,E=h.eB,M=h.IW,Z=i.Z):w||p.includes("failed")?(A=h.AD,C=h.qB,E=h.kq,M=h.Mx,Z=l.Z):p.includes("still pending")&&(A=h.Yc,C=h.$j,E=h.ER,M=h.v4,Z=d.Z));let T=!y&&(w||p.includes("still pending")||p.includes("failed")||p.includes("successful"));return(0,r.jsxs)("div",{className:"min-h-[70vh] ".concat(h.dI," flex flex-col justify-center items-center text-center"),children:[(0,r.jsx)("h1",{className:"".concat(h.ME," text-3xl md:text-4xl mb-8"),children:"Payment Status"}),(0,r.jsxs)("div",{className:"".concat(h.JB," w-full max-w-lg p-6 md:p-8 text-center ").concat(A," border-2 ").concat(C),children:[(0,r.jsx)(Z,{size:64,className:"mb-5 mx-auto ".concat(E," ").concat(y?"animate-spin":"")}),(0,r.jsx)("p",{className:"text-xl md:text-2xl font-semibold mb-3 min-h-[60px] ".concat(M),children:p}),y&&(0,r.jsx)("p",{className:"".concat(h.tM," text-sm"),children:"Verifying details, please hold on..."}),w&&(0,r.jsxs)("div",{className:"mt-4 p-3 rounded-md text-sm ".concat(h.AD," border ").concat(h.qB," ").concat(h.Mx," text-left whitespace-pre-wrap"),children:[(0,r.jsx)("strong",{children:"Details:"})," ",w]})]}),T&&(0,r.jsx)("div",{className:"mt-8 flex flex-col sm:flex-row gap-4 w-full max-w-lg",children:p.includes("successful")&&n?(0,r.jsxs)(o.default,{href:"/user/bookings",className:"".concat(h.zi," w-full"),children:[(0,r.jsx)(f.Z,{size:18,className:"mr-2"})," View My Bookings"]}):p.includes("successful")&&!n?(0,r.jsxs)(o.default,{href:"/",className:"".concat(h.zi," w-full"),children:[(0,r.jsx)(m.Z,{size:18,className:"mr-2"})," Go to Homepage"]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(o.default,{href:"/packages",className:"".concat(h.zi," w-full bg-white hover:bg-gray-100 text-gray-700 border-gray-300"),children:[(0,r.jsx)(m.Z,{size:18,className:"mr-2"})," Back to Packages"]}),(0,r.jsx)(o.default,{href:"/contact",className:"".concat(h.zi," w-full"),children:"Contact Support"})]})})]})}function p(){return(0,r.jsx)("div",{className:"".concat(h.Cx," min-h-screen"),children:(0,r.jsx)(c.Suspense,{fallback:(0,r.jsxs)("div",{className:"min-h-screen ".concat(h.dI," flex flex-col justify-center items-center text-center ").concat(h.Cx),children:[(0,r.jsx)(u.Z,{size:48,className:"animate-spin ".concat(h.O9," mb-4")}),(0,r.jsx)("h1",{className:"".concat(h.ME," text-2xl ").concat(h.Wx),children:"Loading Payment Details..."}),(0,r.jsx)("p",{className:"".concat(h.tM),children:"Please wait a moment."})]}),children:(0,r.jsx)(g,{})})})}},4603:function(e,t,n){"use strict";n.d(t,{H:function(){return s},a:function(){return u}});var r=n(7437),c=n(2265),a=n(9376);let o=(0,c.createContext)(void 0),s=e=>{let{children:t}=e,[n,s]=(0,c.useState)(null),[u,i]=(0,c.useState)(!0),l=(0,a.useRouter)(),d=(0,c.useCallback)(async()=>{try{console.log("Checking auth state via /api/auth/me...");let e=await fetch("/api/auth/me",{method:"GET",headers:{"Content-Type":"application/json",Accept:"application/json"},credentials:"include"}),t=await e.json();e.ok&&t.success&&t.data?(console.log("Auth check successful, user found:",t.data),s(t.data)):(console.log("Auth check failed or no user session found."),s(null))}catch(e){console.error("Error checking auth state:",e),s(null)}finally{i(!1)}},[]);(0,c.useEffect)(()=>{i(!0),d()},[d]);let f=(0,c.useCallback)(async(e,t)=>{i(!0);try{console.log("Attempting login with:",e);let n=await fetch("/api/auth/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e,password:t}),credentials:"include"}),r=await n.json();if(n.ok&&r.success&&r.data)return console.log("Login successful:",r.data),s(r.data),i(!1),{success:!0,user:r.data};return console.error("Login API failed:",r.message),s(null),i(!1),{success:!1,user:null}}catch(e){return console.error("Login fetch error:",e),s(null),i(!1),{success:!1,user:null}}},[]),m=(0,c.useCallback)(async(e,t,n)=>{i(!0);try{console.log("Attempting registration for:",t);let r=await fetch("/api/auth/register",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:e,email:t,password:n})}),c=await r.json();if(r.ok&&c.success)return console.log("Registration successful",c.message),i(!1),{success:!0,message:c.message||"Registration successful!"};return console.error("Registration API failed:",c.message),i(!1),{success:!1,message:c.message||"Registration failed."}}catch(e){return console.error("Registration fetch error:",e),i(!1),{success:!1,message:"An unexpected error occurred."}}},[]),h=(0,c.useCallback)(async()=>{try{console.log("Logging out..."),await fetch("/api/auth/logout",{method:"POST",credentials:"include"})}catch(e){console.error("Logout API call failed:",e)}finally{s(null),console.log("Redirecting to signin page after logout."),l.push("/auth/signin")}},[l]);return(0,r.jsx)(o.Provider,{value:{user:n,isAuthenticated:!!n,isLoading:u,login:f,register:m,logout:h,checkAuthState:d},children:t})},u=()=>{let e=(0,c.useContext)(o);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}},5960:function(e,t,n){"use strict";n.d(t,{$j:function(){return h},AD:function(){return k},Bc:function(){return i},Cx:function(){return N},ER:function(){return p},IW:function(){return d},J:function(){return S},JB:function(){return R},ME:function(){return z},MP:function(){return l},Mx:function(){return j},O9:function(){return u},UX:function(){return O},Wl:function(){return w},Wx:function(){return s},X2:function(){return Y},Yc:function(){return m},dI:function(){return T},dS:function(){return q},eB:function(){return f},ft:function(){return x},hc:function(){return b},kq:function(){return P},l8:function(){return a},m$:function(){return y},mT:function(){return W},nd:function(){return A},o5:function(){return r},oW:function(){return B},pb:function(){return L},qB:function(){return v},qc:function(){return C},qf:function(){return E},rW:function(){return D},si:function(){return F},tA:function(){return _},tM:function(){return M},v4:function(){return g},x7:function(){return o},xb:function(){return Z},zi:function(){return I}});let r="bg-gray-800",c="text-white",a="bg-blue-50",o="border-blue-100",s="text-blue-800",u="text-blue-600",i="bg-green-50",l="border-green-100",d="text-green-800",f="text-green-600",m="bg-orange-50",h="border-orange-100",g="text-orange-800",p="text-orange-600",x="bg-yellow-50",y="border-yellow-100",b="text-yellow-800",w="text-yellow-700",k="bg-red-50",v="border-red-200",j="text-red-700",P="text-red-500",N="bg-gray-50",S="border-gray-100",A="bg-gray-100",C="border-gray-200",E="text-gray-800",M="text-gray-600",Z="text-gray-600",T="py-10 md:py-12",z="text-2xl font-bold ".concat(E," mb-6 flex items-center"),R="bg-white rounded-2xl shadow-sm border ".concat(S," p-6 transition-shadow hover:shadow-md"),I="inline-flex items-center justify-center ".concat(r," ").concat("hover:bg-gray-900"," ").concat(c," px-6 py-3 rounded-full font-medium transition-all duration-300 shadow-md"),B="inline-flex items-center justify-center ".concat("bg-white/20 backdrop-blur-sm"," ").concat("hover:bg-white/30"," ").concat("text-white"," ").concat("border border-white/40"," px-6 py-3 rounded-full font-medium transition-all duration-300");"".concat(a," rounded-2xl p-6 shadow-sm border ").concat(o),"".concat(m," rounded-2xl p-6 shadow-sm border ").concat(h),"".concat(i," rounded-2xl p-6 shadow-sm border ").concat(l),"".concat(x," rounded-2xl p-6 shadow-sm border ").concat(y);let L="bg-white p-2 rounded-full shadow-sm mr-3 border ".concat(S),q="flex items-center",O="hover:text-white",W="mx-1";"".concat(A," p-1 rounded-full inline-flex border ").concat(C),"".concat(r," ").concat(c," shadow-sm");let D="relative h-[50vh] w-full rounded-2xl overflow-hidden shadow-lg mb-4 border ".concat(S),_="absolute bottom-0 left-0 right-0 p-6 bg-gradient-to-t from-black/70 to-transparent",Y="w-full px-4 py-3 rounded-lg border ".concat(C," bg-white ").concat(E," placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-200"),F="block text-sm font-medium ".concat(E," mb-2")}},function(e){e.O(0,[2972,2971,2117,1744],function(){return e(e.s=8568)}),_N_E=e.O()}]);