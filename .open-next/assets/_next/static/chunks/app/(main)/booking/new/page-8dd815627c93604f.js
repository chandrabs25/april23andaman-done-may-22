(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9922],{449:function(e,t,s){Promise.resolve().then(s.bind(s,1406))},1406:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return Z},dynamic:function(){return P}});var a=s(7437),r=s(2265),n=s(9376),l=s(7648),o=s(4603),i=s(5863),c=s(3639),u=s(2660),d=s(4794),m=s(2720),g=s(5805),h=s(8226),x=s(9889),p=s(1994),f=s(3335);function b(){for(var e=arguments.length,t=Array(e),s=0;s<e;s++)t[s]=arguments[s];return(0,f.m6)((0,p.W)(t))}let j=r.forwardRef((e,t)=>{let{className:s,type:r,...n}=e;return(0,a.jsx)("input",{type:r,className:b("flex h-9 w-full rounded-md border border-input bg-transparent px-3 py-1 text-base shadow-sm transition-colors file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",s),ref:t,...n})});j.displayName="Input";var y=s(5293),_=s(535);let N=(0,_.j)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground shadow hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground shadow-sm hover:bg-destructive/90",outline:"border border-input bg-background shadow-sm hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground shadow-sm hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2",sm:"h-8 rounded-md px-3 text-xs",lg:"h-10 rounded-md px-8",icon:"h-9 w-9"}},defaultVariants:{variant:"default",size:"default"}}),v=r.forwardRef((e,t)=>{let{className:s,variant:r,size:n,asChild:l=!1,...o}=e,i=l?y.g7:"button";return(0,a.jsx)(i,{className:b(N({variant:r,size:n,className:s})),ref:t,...o})});v.displayName="Button";var w=s(1107);let k=(0,_.j)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),R=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)(w.f,{ref:t,className:b(k(),s),...r})});R.displayName=w.f.displayName;let S=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)("textarea",{className:b("flex min-h-[60px] w-full rounded-md border border-input bg-transparent px-3 py-2 text-base shadow-sm placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",s),ref:t,...r})});S.displayName="Textarea";var F=s(1047),L=s(2369),C=s(9345),E=s(3041),U=s(3245),I=s(5252);function A(e){let{packageDetails:t,categoryDetails:s,user:l}=e,[o,i]=(0,r.useState)({total_people:1,start_date:"",end_date:"",guest_name:(null==l?void 0:l.name)||"",guest_email:(null==l?void 0:l.email)||"",guest_phone:(null==l?void 0:l.phone)||"",special_requests:""}),[c,u]=(0,r.useState)(s.price*o.total_people),[d,m]=(0,r.useState)({}),[h,x]=(0,r.useState)(!1),p=(0,n.useRouter)();(0,r.useEffect)(()=>{u(s.price*o.total_people)},[o.total_people,s.price]),(0,r.useEffect)(()=>{l&&i(e=>({...e,guest_name:e.guest_name||l.name||"",guest_email:e.guest_email||l.email||"",guest_phone:e.guest_phone||l.phone||""}))},[l]);let f=e=>{let{name:t,value:s}=e.target,a=s;"total_people"===t&&(isNaN(a=parseInt(s,10))||a<1)&&(a=1),i(e=>({...e,[t]:a}))},b=()=>{let e={};return o.total_people<1&&(e.total_people="Number of travelers must be at least 1."),o.start_date||(e.start_date="Start date is required."),o.end_date||(e.end_date="End date is required."),o.start_date&&o.end_date&&new Date(o.start_date)>=new Date(o.end_date)&&(e.end_date="End date must be after the start date."),o.guest_name.trim()||(e.guest_name="Guest name is required."),o.guest_email.trim()?/\S+@\S+\.\S+/.test(o.guest_email)||(e.guest_email="Email is invalid."):e.guest_email="Guest email is required.",o.guest_phone.trim()||(e.guest_phone="Guest phone number is required."),m(e),0===Object.keys(e).length},y=async e=>{if(e.preventDefault(),m(e=>({...e,general:void 0})),!b())return;x(!0);let a={packageId:t.id,packageCategoryId:s.id,total_people:o.total_people,start_date:o.start_date,end_date:o.end_date,guest_name:o.guest_name,guest_email:o.guest_email,guest_phone:o.guest_phone,special_requests:o.special_requests||""};try{let e=await fetch("/api/bookings",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)}),t=await e.json();e.ok&&201===e.status&&t.booking_id?p.push("/booking/confirmation/".concat(t.booking_id)):m(s=>({...s,general:t.message||"An unexpected error occurred (Status: ".concat(e.status,")")}))}catch(e){m(e=>({...e,general:"Failed to submit booking. Please check your connection and try again."}))}finally{x(!1)}};return(0,a.jsxs)("form",{onSubmit:y,className:"space-y-6",children:[d.general&&(0,a.jsx)("p",{className:"text-red-500 text-sm p-3 bg-red-50 border border-red-200 rounded-md",children:d.general}),(0,a.jsxs)("div",{children:[(0,a.jsxs)(R,{htmlFor:"total_people",className:"flex items-center mb-1 text-sm font-medium text-gray-700",children:[(0,a.jsx)(g.Z,{className:"w-4 h-4 mr-2 text-blue-600"})," Number of Travelers"]}),(0,a.jsx)(j,{type:"number",id:"total_people",name:"total_people",value:o.total_people,onChange:f,min:"1",className:"w-full"}),d.total_people&&(0,a.jsx)("p",{className:"text-red-500 text-xs mt-1",children:d.total_people})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)(R,{htmlFor:"start_date",className:"flex items-center mb-1 text-sm font-medium text-gray-700",children:[(0,a.jsx)(F.Z,{className:"w-4 h-4 mr-2 text-blue-600"})," Start Date"]}),(0,a.jsx)(j,{type:"date",id:"start_date",name:"start_date",value:o.start_date,onChange:f,className:"w-full"}),d.start_date&&(0,a.jsx)("p",{className:"text-red-500 text-xs mt-1",children:d.start_date})]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)(R,{htmlFor:"end_date",className:"flex items-center mb-1 text-sm font-medium text-gray-700",children:[(0,a.jsx)(F.Z,{className:"w-4 h-4 mr-2 text-blue-600"})," End Date"]}),(0,a.jsx)(j,{type:"date",id:"end_date",name:"end_date",value:o.end_date,onChange:f,className:"w-full"}),d.end_date&&(0,a.jsx)("p",{className:"text-red-500 text-xs mt-1",children:d.end_date})]})]}),(0,a.jsxs)("div",{className:"space-y-4 pt-4 border-t",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-gray-800",children:"Guest Information"}),(0,a.jsxs)("div",{children:[(0,a.jsxs)(R,{htmlFor:"guest_name",className:"flex items-center mb-1 text-sm font-medium text-gray-700",children:[(0,a.jsx)(L.Z,{className:"w-4 h-4 mr-2 text-blue-600"})," Full Name"]}),(0,a.jsx)(j,{type:"text",id:"guest_name",name:"guest_name",value:o.guest_name,onChange:f,placeholder:"Enter full name",className:"w-full"}),d.guest_name&&(0,a.jsx)("p",{className:"text-red-500 text-xs mt-1",children:d.guest_name})]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)(R,{htmlFor:"guest_email",className:"flex items-center mb-1 text-sm font-medium text-gray-700",children:[(0,a.jsx)(C.Z,{className:"w-4 h-4 mr-2 text-blue-600"})," Email Address"]}),(0,a.jsx)(j,{type:"email",id:"guest_email",name:"guest_email",value:o.guest_email,onChange:f,placeholder:"Enter email address",className:"w-full"}),d.guest_email&&(0,a.jsx)("p",{className:"text-red-500 text-xs mt-1",children:d.guest_email})]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)(R,{htmlFor:"guest_phone",className:"flex items-center mb-1 text-sm font-medium text-gray-700",children:[(0,a.jsx)(E.Z,{className:"w-4 h-4 mr-2 text-blue-600"})," Phone Number"]}),(0,a.jsx)(j,{type:"tel",id:"guest_phone",name:"guest_phone",value:o.guest_phone,onChange:f,placeholder:"Enter phone number",className:"w-full"}),d.guest_phone&&(0,a.jsx)("p",{className:"text-red-500 text-xs mt-1",children:d.guest_phone})]})]}),(0,a.jsxs)("div",{className:"pt-4 border-t",children:[(0,a.jsxs)(R,{htmlFor:"special_requests",className:"flex items-center mb-1 text-sm font-medium text-gray-700",children:[(0,a.jsx)(U.Z,{className:"w-4 h-4 mr-2 text-blue-600"})," Special Requests (Optional)"]}),(0,a.jsx)(S,{id:"special_requests",name:"special_requests",value:o.special_requests,onChange:f,placeholder:"Any special requirements or preferences?",rows:4,className:"w-full"})]}),(0,a.jsxs)("div",{className:"pt-6 border-t",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center bg-gray-100 p-4 rounded-lg",children:[(0,a.jsxs)("p",{className:"text-lg font-semibold text-gray-800 flex items-center",children:[(0,a.jsx)(I.Z,{className:"w-5 h-5 mr-2 text-green-600"})," Total Booking Amount:"]}),(0,a.jsxs)("p",{className:"text-2xl font-bold text-green-600",children:["₹",c.toLocaleString("en-IN")]})]}),(0,a.jsxs)("p",{className:"text-xs text-gray-500 mt-1 text-right",children:["Based on ",o.total_people," traveler(s) at ₹",s.price.toLocaleString("en-IN")," per person."]})]}),(0,a.jsx)("div",{className:"pt-6",children:(0,a.jsx)(v,{type:"submit",className:"w-full bg-green-600 hover:bg-green-700 text-white py-3 text-lg disabled:opacity-75",disabled:h,children:h?"Submitting...":"Confirm & Proceed"})})]})}let P="force-dynamic",T=e=>{let{message:t="Loading booking details..."}=e;return(0,a.jsxs)("div",{className:"min-h-screen flex flex-col items-center justify-center bg-gray-50",children:[(0,a.jsx)(i.Z,{className:"h-12 w-12 animate-spin text-blue-600 mb-4"}),(0,a.jsx)("span",{className:"text-lg text-gray-700",children:t})]})},D=e=>{let{title:t="Error",message:s,showBackButton:r=!0}=e;return(0,a.jsxs)("div",{className:"min-h-screen flex flex-col items-center justify-center text-center px-4 py-10 bg-gray-50",children:[(0,a.jsx)(c.Z,{className:"h-16 w-16 text-red-500 mb-6"}),(0,a.jsx)("h2",{className:"text-3xl font-semibold text-gray-800 mb-4",children:t}),(0,a.jsx)("p",{className:"text-gray-600 mb-8 max-w-md",children:s}),r&&(0,a.jsxs)(l.default,{href:"/packages",className:"bg-blue-600 text-white px-6 py-3 rounded-lg hover:bg-blue-700 transition-colors text-lg font-medium inline-flex items-center",children:[(0,a.jsx)(u.Z,{size:20,className:"mr-2"})," Back to Packages"]})]})};function O(){let e=(0,n.useRouter)(),t=(0,n.useSearchParams)(),{user:s,isAuthenticated:i,isLoading:c}=(0,o.a)(),p=t.get("packageId"),f=t.get("categoryId"),[b,j]=(0,r.useState)(null),[y,_]=(0,r.useState)(null),[N,v]=(0,r.useState)(null),{data:w,error:k,status:R}=(0,x.i)(p?"/api/packages/".concat(p):null);return((0,r.useEffect)(()=>{if(!c&&!i){let t=encodeURIComponent(window.location.pathname+window.location.search);e.push("/auth/signin?callbackUrl=".concat(t));return}if(!c&&i){if(!p||!f){v("Package ID or Category ID is missing. Please select a package option again.");return}if("success"===R&&w){var t;j(w);let e=null===(t=w.categories)||void 0===t?void 0:t.find(e=>e.id.toString()===f);e?(_(e),v(null)):(v("The selected category (ID: ".concat(f,") was not found for this package. It might be unavailable.")),_(null))}else"error"===R&&(v((null==k?void 0:k.message)||"Failed to fetch package details for ID: ".concat(p,".")),j(null),_(null))}},[p,f,w,R,k,i,c,e]),c||i&&("loading"===R||"idle"===R))?(0,a.jsx)(T,{message:c?"Authenticating...":"Loading package details..."}):p&&f?N?(0,a.jsx)(D,{message:N}):b&&y?(0,a.jsx)("div",{className:"bg-gray-100 min-h-screen py-8 md:py-12 font-sans",children:(0,a.jsxs)("div",{className:"container mx-auto px-4",children:[(0,a.jsx)("div",{className:"mb-6",children:(0,a.jsxs)("button",{onClick:()=>e.back(),className:"text-blue-600 hover:text-blue-700 inline-flex items-center transition-colors group",children:[(0,a.jsx)(u.Z,{size:18,className:"mr-2 transition-transform group-hover:-translate-x-1"}),"Back"]})}),(0,a.jsxs)("div",{className:"bg-white rounded-xl shadow-xl overflow-hidden p-6 md:p-8",children:[(0,a.jsx)("h1",{className:"text-3xl md:text-4xl font-bold text-gray-800 mb-6",children:"Confirm Your Booking"}),(0,a.jsxs)("section",{className:"mb-8 p-6 bg-blue-50 border border-blue-200 rounded-lg",children:[(0,a.jsxs)("h2",{className:"text-2xl font-semibold text-blue-700 mb-4 flex items-center",children:[(0,a.jsx)(d.Z,{size:24,className:"mr-3"})," Your Selection"]}),(0,a.jsxs)("div",{className:"grid md:grid-cols-2 gap-x-6 gap-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-lg font-medium text-gray-700",children:b.name}),(0,a.jsx)("p",{className:"text-sm text-gray-500",children:"Package"})]}),(0,a.jsxs)("div",{className:"bg-white p-4 rounded-md shadow-sm border",children:[(0,a.jsxs)("h4",{className:"text-md font-semibold text-gray-800 flex items-center mb-1",children:[(0,a.jsx)(m.Z,{size:18,className:"mr-2 text-blue-600"})," ",y.category_name]}),(0,a.jsxs)("p",{className:"text-2xl font-bold text-blue-600 mb-2",children:["₹",y.price.toLocaleString("en-IN"),(0,a.jsx)("span",{className:"text-sm font-normal text-gray-500",children:" / person"})]}),y.category_description&&(0,a.jsx)("p",{className:"text-xs text-gray-600 mb-1",children:y.category_description}),(0,a.jsxs)("p",{className:"text-xs text-gray-600 flex items-center",children:[(0,a.jsx)(g.Z,{size:14,className:"mr-1.5 text-green-500"}),"Covers up to ",y.max_pax_included_in_price," person(s) at this price."]}),y.hotel_details&&(0,a.jsxs)("p",{className:"text-xs text-gray-500 mt-1 border-t pt-1",children:["Hotel: ",y.hotel_details]})]})]})]}),(0,a.jsxs)("section",{className:"mb-8",children:[(0,a.jsxs)("h2",{className:"text-2xl font-semibold text-gray-800 mb-4 flex items-center",children:[(0,a.jsx)(h.Z,{size:24,className:"mr-3 text-green-600"})," Booking Details"]}),(0,a.jsx)(A,{packageDetails:b,categoryDetails:y,user:s})]}),(0,a.jsx)("section",{className:"text-sm text-gray-500 border-t pt-4",children:i&&(null==s?void 0:s.email)?(0,a.jsxs)("p",{children:["Logged in as: ",(0,a.jsx)("span",{className:"font-medium text-gray-700",children:s.email}),". Not you? ",(0,a.jsx)(l.default,{href:"/auth/signout",className:"text-blue-600 hover:underline",children:"Sign out"})]}):c||i?null:(0,a.jsxs)("p",{children:["Please ",(0,a.jsx)(l.default,{href:"/auth/signin?callbackUrl=".concat(encodeURIComponent(window.location.pathname+window.location.search)),className:"text-blue-600 hover:underline",children:"sign in"})," to complete your booking."]})})]})]})}):(0,a.jsx)(D,{message:"Could not load the selected package or category details. Please try again."}):(0,a.jsx)(D,{message:N||"Package ID or Category ID is missing."})}function Z(){return(0,a.jsx)(r.Suspense,{fallback:(0,a.jsx)(T,{message:"Loading page..."}),children:(0,a.jsx)(O,{})})}},4603:function(e,t,s){"use strict";s.d(t,{H:function(){return o},a:function(){return i}});var a=s(7437),r=s(2265),n=s(9376);let l=(0,r.createContext)(void 0),o=e=>{let{children:t}=e,[s,o]=(0,r.useState)(null),[i,c]=(0,r.useState)(!0),u=(0,n.useRouter)(),d=(0,r.useCallback)(async()=>{try{console.log("Checking auth state via /api/auth/me...");let e=await fetch("/api/auth/me",{method:"GET",headers:{"Content-Type":"application/json",Accept:"application/json"},credentials:"include"}),t=await e.json();e.ok&&t.success&&t.data?(console.log("Auth check successful, user found:",t.data),o(t.data)):(console.log("Auth check failed or no user session found."),o(null))}catch(e){console.error("Error checking auth state:",e),o(null)}finally{c(!1)}},[]);(0,r.useEffect)(()=>{c(!0),d()},[d]);let m=(0,r.useCallback)(async(e,t)=>{c(!0);try{console.log("Attempting login with:",e);let s=await fetch("/api/auth/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e,password:t}),credentials:"include"}),a=await s.json();if(s.ok&&a.success&&a.data)return console.log("Login successful:",a.data),o(a.data),c(!1),{success:!0,user:a.data};return console.error("Login API failed:",a.message),o(null),c(!1),{success:!1,user:null}}catch(e){return console.error("Login fetch error:",e),o(null),c(!1),{success:!1,user:null}}},[]),g=(0,r.useCallback)(async(e,t,s)=>{c(!0);try{console.log("Attempting registration for:",t);let a=await fetch("/api/auth/register",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:e,email:t,password:s})}),r=await a.json();if(a.ok&&r.success)return console.log("Registration successful",r.message),c(!1),{success:!0,message:r.message||"Registration successful!"};return console.error("Registration API failed:",r.message),c(!1),{success:!1,message:r.message||"Registration failed."}}catch(e){return console.error("Registration fetch error:",e),c(!1),{success:!1,message:"An unexpected error occurred."}}},[]),h=(0,r.useCallback)(async()=>{try{console.log("Logging out..."),await fetch("/api/auth/logout",{method:"POST",credentials:"include"})}catch(e){console.error("Logout API call failed:",e)}finally{o(null),console.log("Redirecting to signin page after logout."),u.push("/auth/signin")}},[u]);return(0,a.jsx)(l.Provider,{value:{user:s,isAuthenticated:!!s,isLoading:i,login:m,register:g,logout:h,checkAuthState:d},children:t})},i=()=>{let e=(0,r.useContext)(l);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}},9889:function(e,t,s){"use strict";s.d(t,{i:function(){return r}});var a=s(2265);function r(e,t){let s=(0,a.useRef)(!0);s.current&&(console.log("[useFetch] Hook initialized. URL:",e),s.current=!1);let[r,n]=(0,a.useState)({data:null,error:null,status:"idle"}),l=(0,a.useRef)(e),o=(0,a.useRef)(t);JSON.stringify(o.current)!==JSON.stringify(t)&&(o.current=t);let i=(0,a.useRef)(!0);return(0,a.useEffect)(()=>{if(console.log("[useFetch] useEffect entering. URL:",e,"Initial fetch:",i.current),l.current===e&&null!==e&&!i.current){console.log("[useFetch] useEffect skipped - URL unchanged and not first render");return}i.current=!1,l.current=e,console.log("[useFetch] useEffect triggered. URL:",e),(async()=>{if(console.log("[useFetch] fetchData started. URL:",e),!e){console.log("[useFetch] URL is null, setting state to idle/null."),n({data:null,error:null,status:"idle"});return}console.log("[useFetch] Resetting state and setting status to loading."),n({data:null,error:null,status:"loading"});try{let t;console.log("[useFetch] Attempting fetch to URL:",e);let s=e.startsWith("http")?e:"".concat(window.location.origin).concat(e);console.log("[useFetch] Full URL for fetch:",s);let a=await fetch(s,{...o.current,credentials:"include"});console.log("[useFetch] Fetch completed. URL:",e,"Status:",a.status);try{console.log("[useFetch] Attempting response.json(). URL:",e),t=await a.json(),console.log("[useFetch] response.json() successful. URL:",e)}catch(t){throw console.error("[useFetch] response.json() FAILED. URL:",e,"Error:",t),Error("Request failed with status ".concat(a.status," and non-JSON response."))}if(!a.ok){let s=(null==t?void 0:t.message)||a.statusText||"HTTP error! Status: ".concat(a.status);throw console.warn("[useFetch] Response not OK. Status:",a.status,"URL:",e,"Throwing error:",s),Error(s)}if(console.log("[useFetch] Response OK. Checking result.success. URL:",e),t.success)console.log("[useFetch] result.success is true. URL:",e),void 0!==t.data?(console.log("[useFetch] Setting state data and status=success. URL:",e),n({data:t.data,error:null,status:"success"})):(console.warn("[useFetch] Fetch successful (result.success=true) but result.data is undefined. Setting state data=null, status=success. URL: ".concat(e)),n({data:null,error:null,status:"success"}));else{let s=t.message||"API returned success: false";throw console.warn("[useFetch] result.success is false. URL:",e,"Throwing error:",s),Error(s)}}catch(s){console.error("[useFetch] CATCH block error for URL ".concat(e,":"),s);let t=s instanceof Error?s:Error("Unknown fetch error occurred");console.log("[useFetch] Setting state error and status=error. URL:",e),n({data:null,error:t,status:"error"})}})()},[e]),console.log("[useFetch] Returning state for URL:",e,{status:r.status}),{data:r.data,error:r.error,status:r.status,isLoading:"loading"===r.status}}}},function(e){e.O(0,[2972,4060,2971,2117,1744],function(){return e(e.s=449)}),_N_E=e.O()}]);