(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2131],{67639:function(e,t,s){Promise.resolve().then(s.bind(s,87767))},39763:function(e,t,s){"use strict";s.d(t,{Z:function(){return l}});var r=s(2265),a={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};let n=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase().trim(),l=(e,t)=>{let s=(0,r.forwardRef)((s,l)=>{let{color:o="currentColor",size:c=24,strokeWidth:i=2,absoluteStrokeWidth:u,className:d="",children:m,...h}=s;return(0,r.createElement)("svg",{ref:l,...a,width:c,height:c,stroke:o,strokeWidth:u?24*Number(i)/Number(c):i,className:["lucide","lucide-".concat(n(e)),d].join(" "),...h},[...t.map(e=>{let[t,s]=e;return(0,r.createElement)(t,s)}),...Array.isArray(m)?m:[m]])});return s.displayName="".concat(e),s}},63639:function(e,t,s){"use strict";s.d(t,{Z:function(){return r}});let r=(0,s(39763).Z)("AlertTriangle",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z",key:"c3ski4"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]])},31047:function(e,t,s){"use strict";s.d(t,{Z:function(){return r}});let r=(0,s(39763).Z)("Calendar",[["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",ry:"2",key:"eu3xkr"}],["line",{x1:"16",x2:"16",y1:"2",y2:"6",key:"m3sa8f"}],["line",{x1:"8",x2:"8",y1:"2",y2:"6",key:"18kwsl"}],["line",{x1:"3",x2:"21",y1:"10",y2:"10",key:"xt86sb"}]])},30401:function(e,t,s){"use strict";s.d(t,{Z:function(){return r}});let r=(0,s(39763).Z)("Check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]])},91723:function(e,t,s){"use strict";s.d(t,{Z:function(){return r}});let r=(0,s(39763).Z)("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]])},95252:function(e,t,s){"use strict";s.d(t,{Z:function(){return r}});let r=(0,s(39763).Z)("DollarSign",[["line",{x1:"12",x2:"12",y1:"2",y2:"22",key:"7eqyqh"}],["path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6",key:"1b0p4s"}]])},18133:function(e,t,s){"use strict";s.d(t,{Z:function(){return r}});let r=(0,s(39763).Z)("Hotel",[["path",{d:"M18 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V4a2 2 0 0 0-2-2Z",key:"p9z69c"}],["path",{d:"m9 16 .348-.24c1.465-1.013 3.84-1.013 5.304 0L15 16",key:"1bvcvh"}],["path",{d:"M8 7h.01",key:"1vti4s"}],["path",{d:"M16 7h.01",key:"1kdx03"}],["path",{d:"M12 7h.01",key:"1ivr5q"}],["path",{d:"M12 11h.01",key:"z322tv"}],["path",{d:"M16 11h.01",key:"xkw8gn"}],["path",{d:"M8 11h.01",key:"1dfujw"}],["path",{d:"M10 22v-6.5m4 0V22",key:"16gs4s"}]])},15863:function(e,t,s){"use strict";s.d(t,{Z:function(){return r}});let r=(0,s(39763).Z)("Loader2",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]])},89345:function(e,t,s){"use strict";s.d(t,{Z:function(){return r}});let r=(0,s(39763).Z)("Mail",[["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}],["path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7",key:"1ocrg3"}]])},44794:function(e,t,s){"use strict";s.d(t,{Z:function(){return r}});let r=(0,s(39763).Z)("Package",[["path",{d:"m7.5 4.27 9 5.15",key:"1c824w"}],["path",{d:"M21 8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16Z",key:"hh9hay"}],["path",{d:"m3.3 7 8.7 5 8.7-5",key:"g66t2b"}],["path",{d:"M12 22V12",key:"d0xqtd"}]])},13041:function(e,t,s){"use strict";s.d(t,{Z:function(){return r}});let r=(0,s(39763).Z)("Phone",[["path",{d:"M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z",key:"foiqr5"}]])},73247:function(e,t,s){"use strict";s.d(t,{Z:function(){return r}});let r=(0,s(39763).Z)("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]])},92369:function(e,t,s){"use strict";s.d(t,{Z:function(){return r}});let r=(0,s(39763).Z)("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]])},32489:function(e,t,s){"use strict";s.d(t,{Z:function(){return r}});let r=(0,s(39763).Z)("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]])},99376:function(e,t,s){"use strict";var r=s(35475);s.o(r,"useParams")&&s.d(t,{useParams:function(){return r.useParams}}),s.o(r,"usePathname")&&s.d(t,{usePathname:function(){return r.usePathname}}),s.o(r,"useRouter")&&s.d(t,{useRouter:function(){return r.useRouter}}),s.o(r,"useSearchParams")&&s.d(t,{useSearchParams:function(){return r.useSearchParams}})},87767:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return L},dynamic:function(){return N}});var r=s(57437),a=s(2265),n=s(99376),l=s(15863),o=s(30401),c=s(32489),i=s(18133),u=s(44794),d=s(92369),m=s(31047),h=s(95252),g=s(13041),x=s(89345),p=s(91723),f=s(73247),b=s(63639),y=s(29889),v=s(84603);let N="force-dynamic",j=e=>{let{message:t="Loading..."}=e;return(0,r.jsx)("div",{className:"flex items-center justify-center py-12",children:(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)(l.Z,{className:"h-8 w-8 animate-spin text-blue-600 mx-auto mb-2"}),(0,r.jsx)("p",{className:"text-gray-600",children:t})]})})},w=e=>{let{status:t,type:s="booking"}=e,a=((e,t)=>{if("payment"===t)switch(null==e?void 0:e.toUpperCase()){case"PAID":return"bg-green-100 text-green-800 border-green-200";case"PENDING_PAYMENT":case"PENDING":return"bg-yellow-100 text-yellow-800 border-yellow-200";case"FAILED":return"bg-red-100 text-red-800 border-red-200";default:return"bg-gray-100 text-gray-800 border-gray-200"}switch(null==e?void 0:e.toUpperCase()){case"CONFIRMED":return"bg-green-100 text-green-800 border-green-200";case"PENDING":return"bg-yellow-100 text-yellow-800 border-yellow-200";case"COMPLETED":return"bg-blue-100 text-blue-800 border-blue-200";case"CANCELLED":return"bg-red-100 text-red-800 border-red-200";default:return"bg-gray-100 text-gray-800 border-gray-200"}})(t,s);return(0,r.jsx)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium border ".concat(a),children:null==t?void 0:t.toUpperCase()})},k=e=>{var t,s;let{booking:n,onStatusUpdate:l,onViewDetails:p,isUpdating:f}=e,[b,y]=(0,a.useState)(!1),v=e=>{try{return new Date(e).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"})}catch(e){return"Invalid Date"}},N=(e,t)=>{var s;return(null===(s=({PENDING:["CONFIRMED","CANCELLED"],CONFIRMED:["COMPLETED","CANCELLED"],COMPLETED:[],CANCELLED:[]})[null==e?void 0:e.toUpperCase()])||void 0===s?void 0:s.includes(t.toUpperCase()))||!1};return(0,r.jsx)("div",{className:"bg-white border border-gray-200 rounded-lg shadow-sm hover:shadow-md transition-shadow duration-200",children:(0,r.jsxs)("div",{className:"p-6",children:[(0,r.jsxs)("div",{className:"flex items-start justify-between mb-4",children:[(0,r.jsxs)("div",{className:"flex-1",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(null===(t=n.serviceOrPackageName)||void 0===t?void 0:t.includes("Hotel"))?(0,r.jsx)(i.Z,{className:"h-4 w-4 text-blue-600"}):(0,r.jsx)(u.Z,{className:"h-4 w-4 text-green-600"}),(0,r.jsx)("h3",{className:"text-lg font-semibold text-gray-900 truncate",children:n.serviceOrPackageName})]}),(0,r.jsxs)("div",{className:"flex items-center gap-4 text-sm text-gray-600",children:[(0,r.jsxs)("div",{className:"flex items-center gap-1",children:[(0,r.jsx)(d.Z,{className:"h-4 w-4"}),(0,r.jsx)("span",{children:n.customerName})]}),(0,r.jsxs)("div",{className:"flex items-center gap-1",children:[(0,r.jsx)(m.Z,{className:"h-4 w-4"}),(0,r.jsxs)("span",{children:[v(n.start_date)," - ",v(n.end_date)]})]})]})]}),(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)(w,{status:n.status,type:"booking"}),n.payment_status&&(0,r.jsx)(w,{status:n.payment_status,type:"payment"})]})]}),(0,r.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-4 text-sm",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2 text-gray-600",children:[(0,r.jsx)(d.Z,{className:"h-4 w-4"}),(0,r.jsxs)("span",{children:[n.total_people," guests"]})]}),(0,r.jsxs)("div",{className:"flex items-center gap-2 text-gray-600",children:[(0,r.jsx)(h.Z,{className:"h-4 w-4"}),(0,r.jsxs)("span",{children:["₹",null===(s=n.total_amount)||void 0===s?void 0:s.toLocaleString("en-IN")]})]}),n.guest_phone&&(0,r.jsxs)("div",{className:"flex items-center gap-2 text-gray-600",children:[(0,r.jsx)(g.Z,{className:"h-4 w-4"}),(0,r.jsx)("span",{children:n.guest_phone})]}),n.guest_email&&(0,r.jsxs)("div",{className:"flex items-center gap-2 text-gray-600",children:[(0,r.jsx)(x.Z,{className:"h-4 w-4"}),(0,r.jsx)("span",{className:"truncate",children:n.guest_email})]})]}),(0,r.jsxs)("div",{className:"flex items-center justify-between pt-4 border-t border-gray-200",children:[(0,r.jsx)("button",{onClick:()=>p(n.id),className:"text-blue-600 hover:text-blue-800 text-sm font-medium",children:"View Details"}),(0,r.jsx)("div",{className:"flex items-center gap-2",children:(e=>{let t=[];return N(e,"CONFIRMED")&&t.push((0,r.jsxs)("button",{onClick:()=>l(n.id,"CONFIRMED"),disabled:f,className:"inline-flex items-center px-3 py-1 text-sm font-medium text-green-700 bg-green-50 border border-green-200 rounded-md hover:bg-green-100 disabled:opacity-50",children:[(0,r.jsx)(o.Z,{className:"h-3 w-3 mr-1"}),"Confirm"]},"confirm")),N(e,"COMPLETED")&&t.push((0,r.jsxs)("button",{onClick:()=>l(n.id,"COMPLETED"),disabled:f,className:"inline-flex items-center px-3 py-1 text-sm font-medium text-blue-700 bg-blue-50 border border-blue-200 rounded-md hover:bg-blue-100 disabled:opacity-50",children:[(0,r.jsx)(o.Z,{className:"h-3 w-3 mr-1"}),"Complete"]},"complete")),N(e,"CANCELLED")&&t.push((0,r.jsxs)("button",{onClick:()=>l(n.id,"CANCELLED"),disabled:f,className:"inline-flex items-center px-3 py-1 text-sm font-medium text-red-700 bg-red-50 border border-red-200 rounded-md hover:bg-red-100 disabled:opacity-50",children:[(0,r.jsx)(c.Z,{className:"h-3 w-3 mr-1"}),"Cancel"]},"cancel")),t})(n.status)})]})]})})};function L(){let e=(0,n.useRouter)(),{user:t,isLoading:s}=(0,v.a)(),[l,c]=(0,a.useState)("all"),[i,u]=(0,a.useState)(""),[d,g]=(0,a.useState)(""),[x,N]=(0,a.useState)([]),{data:w,error:L,status:C}=(0,y.i)((null==t?void 0:t.id)?"/api/vendors/bookings?vendorUserId=".concat(t.id,"&limit=100"):null),{submit:E,isLoading:R}=function(){let[e,t]=(0,a.useState)(!1),[s,r]=(0,a.useState)(null);return{submit:(0,a.useCallback)(async function(e){let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"POST",a=arguments.length>2?arguments[2]:void 0,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};t(!0),r(null);try{let t;let l={method:s,headers:{"Content-Type":"application/json",...n.headers},...n};a&&["POST","PUT","PATCH"].includes(s.toUpperCase())&&(l.body=JSON.stringify(a));let o=await fetch(e,l),c=o.headers.get("content-type");if(t=c&&c.includes("application/json")?await o.json():await o.text(),!o.ok){let e=(null==t?void 0:t.message)||(null==t?void 0:t.error)||"HTTP error! status: ".concat(o.status);return r(e),{success:!1,error:e,message:e}}return{success:!0,data:t,message:null==t?void 0:t.message}}catch(t){let e=t instanceof Error?t.message:"An unexpected error occurred";return r(e),{success:!1,error:e,message:e}}finally{t(!1)}},[]),isLoading:e,error:s,reset:(0,a.useCallback)(()=>{r(null),t(!1)},[])}}(),[S,U]=(0,a.useState)({total:0,pending:0,confirmed:0,completed:0,cancelled:0,totalRevenue:0});(0,a.useEffect)(()=>{w&&N(w)},[w]),(0,a.useEffect)(()=>{x.length>0&&U(x.reduce((e,t)=>{var s,r;switch(e.total++,null===(s=t.status)||void 0===s?void 0:s.toUpperCase()){case"PENDING":e.pending++;break;case"CONFIRMED":e.confirmed++;break;case"COMPLETED":e.completed++,(null===(r=t.payment_status)||void 0===r?void 0:r.toUpperCase())==="PAID"&&(e.totalRevenue+=t.total_amount||0);break;case"CANCELLED":e.cancelled++}return e},{total:0,pending:0,confirmed:0,completed:0,cancelled:0,totalRevenue:0}))},[x]);let Z=(null==x?void 0:x.filter(e=>{var t,s,r,a,n;if("all"!==l&&(null===(t=e.status)||void 0===t?void 0:t.toUpperCase())!==l.toUpperCase())return!1;if(i){let t=i.toLowerCase();return(null===(s=e.serviceOrPackageName)||void 0===s?void 0:s.toLowerCase().includes(t))||(null===(r=e.customerName)||void 0===r?void 0:r.toLowerCase().includes(t))||(null===(a=e.guest_email)||void 0===a?void 0:a.toLowerCase().includes(t))||(null===(n=e.guest_phone)||void 0===n?void 0:n.includes(i))}return!0}))||[],A=async(e,t)=>{try{let s=await E("/api/vendor/bookings/".concat(e,"/status"),"PUT",{status:t});s.success?(N(s=>s.map(s=>s.id===e?{...s,status:t.toUpperCase()}:s)),console.log("Booking ".concat(e," status updated to ").concat(t))):alert(s.message||"Failed to update booking status")}catch(e){console.error("Error updating booking status:",e),alert("Failed to update booking status")}},P=t=>{e.push("/manage-bookings/".concat(t))};if(s)return(0,r.jsx)(j,{message:"Authenticating..."});if(!(null==t?void 0:t.id))return(0,r.jsx)("div",{className:"container mx-auto px-4 py-8",children:(0,r.jsx)("p",{className:"text-red-600",children:"Authentication required"})});let F=[{id:"all",label:"All",count:S.total},{id:"pending",label:"Pending",count:S.pending},{id:"confirmed",label:"Confirmed",count:S.confirmed},{id:"completed",label:"Completed",count:S.completed},{id:"cancelled",label:"Cancelled",count:S.cancelled}];return(0,r.jsxs)("div",{className:"container mx-auto px-4 py-8",children:[(0,r.jsxs)("div",{className:"mb-8",children:[(0,r.jsx)("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"Manage Bookings"}),(0,r.jsx)("p",{className:"text-gray-600",children:"View and manage all your bookings from one place"})]}),(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4 mb-8",children:[(0,r.jsx)("div",{className:"bg-white p-6 rounded-lg shadow-sm border border-gray-200",children:(0,r.jsxs)("div",{className:"flex items-center",children:[(0,r.jsxs)("div",{className:"flex-1",children:[(0,r.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Total Bookings"}),(0,r.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:S.total})]}),(0,r.jsx)(m.Z,{className:"h-8 w-8 text-blue-600"})]})}),(0,r.jsx)("div",{className:"bg-white p-6 rounded-lg shadow-sm border border-gray-200",children:(0,r.jsxs)("div",{className:"flex items-center",children:[(0,r.jsxs)("div",{className:"flex-1",children:[(0,r.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Pending"}),(0,r.jsx)("p",{className:"text-2xl font-bold text-yellow-600",children:S.pending})]}),(0,r.jsx)(p.Z,{className:"h-8 w-8 text-yellow-600"})]})}),(0,r.jsx)("div",{className:"bg-white p-6 rounded-lg shadow-sm border border-gray-200",children:(0,r.jsxs)("div",{className:"flex items-center",children:[(0,r.jsxs)("div",{className:"flex-1",children:[(0,r.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Confirmed"}),(0,r.jsx)("p",{className:"text-2xl font-bold text-green-600",children:S.confirmed})]}),(0,r.jsx)(o.Z,{className:"h-8 w-8 text-green-600"})]})}),(0,r.jsx)("div",{className:"bg-white p-6 rounded-lg shadow-sm border border-gray-200",children:(0,r.jsxs)("div",{className:"flex items-center",children:[(0,r.jsxs)("div",{className:"flex-1",children:[(0,r.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Completed"}),(0,r.jsx)("p",{className:"text-2xl font-bold text-blue-600",children:S.completed})]}),(0,r.jsx)(o.Z,{className:"h-8 w-8 text-blue-600"})]})}),(0,r.jsx)("div",{className:"bg-white p-6 rounded-lg shadow-sm border border-gray-200",children:(0,r.jsxs)("div",{className:"flex items-center",children:[(0,r.jsxs)("div",{className:"flex-1",children:[(0,r.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Total Revenue"}),(0,r.jsxs)("p",{className:"text-2xl font-bold text-green-600",children:["₹",S.totalRevenue.toLocaleString("en-IN")]})]}),(0,r.jsx)(h.Z,{className:"h-8 w-8 text-green-600"})]})})]}),(0,r.jsx)("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 mb-6",children:(0,r.jsxs)("div",{className:"p-6",children:[(0,r.jsx)("div",{className:"border-b border-gray-200 mb-4",children:(0,r.jsx)("nav",{className:"-mb-px flex space-x-8",children:F.map(e=>(0,r.jsxs)("button",{onClick:()=>c(e.id),className:"py-4 px-1 border-b-2 font-medium text-sm whitespace-nowrap ".concat(l===e.id?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),children:[e.label,(0,r.jsx)("span",{className:"ml-2 py-0.5 px-2 rounded-full text-xs ".concat(l===e.id?"bg-blue-100 text-blue-600":"bg-gray-100 text-gray-600"),children:e.count})]},e.id))})}),(0,r.jsx)("div",{className:"flex items-center gap-4",children:(0,r.jsxs)("div",{className:"flex-1 relative",children:[(0,r.jsx)(f.Z,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),(0,r.jsx)("input",{type:"text",placeholder:"Search bookings...",value:i,onChange:e=>u(e.target.value),className:"pl-10 pr-4 py-2 w-full border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500"})]})})]})}),(0,r.jsxs)("div",{children:["loading"===C&&(0,r.jsx)(j,{message:"Loading bookings..."}),"error"===C&&(0,r.jsx)("div",{className:"bg-red-50 border-l-4 border-red-400 p-4",children:(0,r.jsxs)("div",{className:"flex",children:[(0,r.jsx)(b.Z,{className:"h-5 w-5 text-red-400"}),(0,r.jsx)("div",{className:"ml-3",children:(0,r.jsxs)("p",{className:"text-sm text-red-700",children:["Failed to load bookings: ",(null==L?void 0:L.message)||"Unknown error"]})})]})}),"success"===C&&(0,r.jsx)(r.Fragment,{children:0===Z.length?(0,r.jsxs)("div",{className:"text-center py-12 bg-gray-50 rounded-lg",children:[(0,r.jsx)(m.Z,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),(0,r.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No bookings found"}),(0,r.jsx)("p",{className:"text-gray-600",children:i?"Try adjusting your search terms.":"No bookings match the current filter."})]}):(0,r.jsx)("div",{className:"grid gap-6",children:Z.map(e=>(0,r.jsx)(k,{booking:e,onStatusUpdate:A,onViewDetails:P,isUpdating:R},e.id))})})]})]})}},84603:function(e,t,s){"use strict";s.d(t,{H:function(){return o},a:function(){return c}});var r=s(57437),a=s(2265),n=s(99376);let l=(0,a.createContext)(void 0),o=e=>{let{children:t}=e,[s,o]=(0,a.useState)(null),[c,i]=(0,a.useState)(!0),u=(0,n.useRouter)(),d=(0,a.useCallback)(async()=>{try{console.log("Checking auth state via /api/auth/me...");let e=await fetch("/api/auth/me",{method:"GET",headers:{"Content-Type":"application/json",Accept:"application/json"},credentials:"include"}),t=await e.json();e.ok&&t.success&&t.data?(console.log("Auth check successful, user found:",t.data),o(t.data)):(console.log("Auth check failed or no user session found."),o(null))}catch(e){console.error("Error checking auth state:",e),o(null)}finally{i(!1)}},[]);(0,a.useEffect)(()=>{i(!0),d()},[d]);let m=(0,a.useCallback)(async(e,t)=>{i(!0);try{console.log("Attempting login with:",e);let s=await fetch("/api/auth/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e,password:t}),credentials:"include"}),r=await s.json();if(s.ok&&r.success&&r.data)return console.log("Login successful:",r.data),o(r.data),i(!1),{success:!0,user:r.data};return console.error("Login API failed:",r.message),o(null),i(!1),{success:!1,user:null}}catch(e){return console.error("Login fetch error:",e),o(null),i(!1),{success:!1,user:null}}},[]),h=(0,a.useCallback)(async(e,t,s)=>{i(!0);try{console.log("Attempting registration for:",t);let r=await fetch("/api/auth/register",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:e,email:t,password:s})}),a=await r.json();if(r.ok&&a.success)return console.log("Registration successful",a.message),i(!1),{success:!0,message:a.message||"Registration successful!"};return console.error("Registration API failed:",a.message),i(!1),{success:!1,message:a.message||"Registration failed."}}catch(e){return console.error("Registration fetch error:",e),i(!1),{success:!1,message:"An unexpected error occurred."}}},[]),g=(0,a.useCallback)(async()=>{try{console.log("Logging out..."),await fetch("/api/auth/logout",{method:"POST",credentials:"include"})}catch(e){console.error("Logout API call failed:",e)}finally{o(null),console.log("Redirecting to signin page after logout."),u.push("/auth/signin")}},[u]);return(0,r.jsx)(l.Provider,{value:{user:s,isAuthenticated:!!s,isLoading:c,login:m,register:h,logout:g,checkAuthState:d},children:t})},c=()=>{let e=(0,a.useContext)(l);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}},29889:function(e,t,s){"use strict";s.d(t,{i:function(){return a},q:function(){return n}});var r=s(2265);function a(e,t){let s=(0,r.useRef)(!0);s.current&&(console.log("[useFetch] Hook initialized. URL:",e),s.current=!1);let[a,n]=(0,r.useState)({data:null,error:null,status:"idle"}),l=(0,r.useRef)(e),o=(0,r.useRef)(t);JSON.stringify(o.current)!==JSON.stringify(t)&&(o.current=t);let c=(0,r.useRef)(!0);return(0,r.useEffect)(()=>{if(console.log("[useFetch] useEffect entering. URL:",e,"Initial fetch:",c.current),l.current===e&&null!==e&&!c.current){console.log("[useFetch] useEffect skipped - URL unchanged and not first render");return}c.current=!1,l.current=e,console.log("[useFetch] useEffect triggered. URL:",e),(async()=>{if(console.log("[useFetch] fetchData started. URL:",e),!e){console.log("[useFetch] URL is null, setting state to idle/null."),n({data:null,error:null,status:"idle"});return}console.log("[useFetch] Resetting state and setting status to loading."),n({data:null,error:null,status:"loading"});try{let t;console.log("[useFetch] Attempting fetch to URL:",e);let s=e.startsWith("http")?e:"".concat(window.location.origin).concat(e);console.log("[useFetch] Full URL for fetch:",s);let r=await fetch(s,{...o.current,credentials:"include"});console.log("[useFetch] Fetch completed. URL:",e,"Status:",r.status);try{console.log("[useFetch] Attempting response.json(). URL:",e),t=await r.json(),console.log("[useFetch] response.json() successful. URL:",e)}catch(t){throw console.error("[useFetch] response.json() FAILED. URL:",e,"Error:",t),Error("Request failed with status ".concat(r.status," and non-JSON response."))}if(!r.ok){let s=(null==t?void 0:t.message)||r.statusText||"HTTP error! Status: ".concat(r.status);throw console.warn("[useFetch] Response not OK. Status:",r.status,"URL:",e,"Throwing error:",s),Error(s)}if(console.log("[useFetch] Response OK. Checking result.success. URL:",e),t.success)console.log("[useFetch] result.success is true. URL:",e),void 0!==t.data?(console.log("[useFetch] Setting state data and status=success. URL:",e),n({data:t.data,error:null,status:"success"})):(console.warn("[useFetch] Fetch successful (result.success=true) but result.data is undefined. Setting state data=null, status=success. URL: ".concat(e)),n({data:null,error:null,status:"success"}));else{let s=t.message||"API returned success: false";throw console.warn("[useFetch] result.success is false. URL:",e,"Throwing error:",s),Error(s)}}catch(s){console.error("[useFetch] CATCH block error for URL ".concat(e,":"),s);let t=s instanceof Error?s:Error("Unknown fetch error occurred");console.log("[useFetch] Setting state error and status=error. URL:",e),n({data:null,error:t,status:"error"})}})()},[e]),console.log("[useFetch] Returning state for URL:",e,{status:a.status}),{data:a.data,error:a.error,status:a.status,isLoading:"loading"===a.status}}function n(e){let t=(0,r.useRef)(!0);t.current&&(console.log("[useSubmit] Hook initialized. Initial URL:",e),t.current=!1);let[s,a]=(0,r.useState)(null),[n,l]=(0,r.useState)(null),[o,c]=(0,r.useState)("idle");return{submit:async function(t){let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"POST",r=arguments.length>2?arguments[2]:void 0,n=r||e;if(console.log("[useSubmit] submit function called. Target URL:",n,"Method:",s),c("loading"),a(null),l(null),!n)return console.error("[useSubmit] No URL provided (initial or override). Aborting submission."),l(Error("No URL specified for submission.")),c("error"),{success:!1,error:"No URL specified for submission."};try{let e;let r={method:s,headers:{"Content-Type":"application/json",Accept:"application/json"},body:"DELETE"!==s?JSON.stringify(t):void 0,credentials:"include"};console.log("[useSubmit] Attempting fetch. URL:",n);let l=await fetch(n,r);console.log("[useSubmit] Fetch completed. URL:",n,"Status:",l.status);try{console.log("[useSubmit] Attempting response.json(). URL:",n),204===l.status||"0"===l.headers.get("content-length")?(console.log("[useSubmit] Received 204 No Content or empty body. Assuming success."),e={success:!0}):e=await l.json(),console.log("[useSubmit] response.json() successful or handled empty. URL:",n)}catch(e){throw console.error("[useSubmit] response.json() FAILED. URL:",n,"Error:",e),Error("Request failed with status ".concat(l.status," and non-JSON response."))}if(console.log("[useSubmit] Checking response.ok and result.success. URL:",n),l.ok&&(void 0===e.success||!0===e.success)){if(console.log("[useSubmit] Response OK and result.success is true/undefined. URL:",n),void 0!==e.data)return console.log("[useSubmit] Setting data and status=success. URL:",n),a(e.data),c("success"),{success:!0,data:e.data};return a(null),c("success"),console.warn("[useSubmit] Submit successful (result.success=true/undefined) but result.data is undefined. Setting data=null, status=success. URL: ".concat(n)),{success:!0,data:null}}{let t=e.message||"API Error: Status ".concat(l.status,", Success Flag: ").concat(e.success);throw console.warn("[useSubmit] Response NOT OK or result.success is false. URL:",n,"Throwing error:",t),Error(t)}}catch(t){console.error("[useSubmit] CATCH block error. URL:",n,"Error:",t);let e=t instanceof Error?t.message:"Unknown submit error occurred";return console.log("[useSubmit] Setting error state and status=error. URL:",n),l(Error(e)),c("error"),{success:!1,error:e}}},data:s,error:n,status:o,isLoading:"loading"===o,reset:()=>{console.log("[useSubmit] reset function called."),a(null),l(null),c("idle")}}}}},function(e){e.O(0,[2971,2117,1744],function(){return e(e.s=67639)}),_N_E=e.O()}]);