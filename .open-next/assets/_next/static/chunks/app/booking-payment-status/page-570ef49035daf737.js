(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[140],{3193:function(e,t,n){Promise.resolve().then(n.bind(n,7131))},7648:function(e,t,n){"use strict";n.d(t,{default:function(){return a.a}});var r=n(2972),a=n.n(r)},9376:function(e,t,n){"use strict";var r=n(5475);n.o(r,"useParams")&&n.d(t,{useParams:function(){return r.useParams}}),n.o(r,"usePathname")&&n.d(t,{usePathname:function(){return r.usePathname}}),n.o(r,"useRouter")&&n.d(t,{useRouter:function(){return r.useRouter}}),n.o(r,"useSearchParams")&&n.d(t,{useSearchParams:function(){return r.useSearchParams}})},7131:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return c}});var r=n(7437),a=n(2265),s=n(9376),i=n(7648);function o(){let e=(0,s.useRouter)(),t=(0,s.useSearchParams)().get("mtid"),[n,o]=(0,a.useState)("Verifying payment status, please wait..."),[c,u]=(0,a.useState)(!0),[l,d]=(0,a.useState)(null),[f,m]=(0,a.useState)(0),p=(0,a.useRef)(null);return(0,a.useEffect)(()=>{if(!t){o("Invalid payment session. Merchant Transaction ID is missing."),u(!1),d("No transaction ID found in URL.");return}let n=async r=>{u(!0),m(r);try{let a=await fetch("/api/bookings/check-payment-status?mtid=".concat(t));if(!a.ok){let e="Error: ".concat(a.status," ").concat(a.statusText||"Failed to fetch status");try{e=(await a.json()).message||e}catch(e){}o("Failed to verify payment status."),d(e),u(!1),p.current&&clearTimeout(p.current);return}let s=await a.json();s.success?"PAYMENT_SUCCESS"===s.phonePePaymentStatus||"CONFIRMED"===s.bookingStatus?(o("Payment successful! Redirecting to your booking confirmation..."),d(null),u(!1),p.current&&clearTimeout(p.current),p.current=setTimeout(()=>e.push("/booking/confirmation/".concat(t)),2e3)):"PAYMENT_PENDING"===s.phonePePaymentStatus||"PENDING_PAYMENT"===s.bookingStatus?r<5?(o("Payment is pending. Checking again soon... (Attempt ".concat(r+1,"/").concat(5,")")),p.current&&clearTimeout(p.current),p.current=setTimeout(()=>n(r+1),5e3)):(o("Payment is still pending. We will update you once confirmed."),d('Your payment is taking longer than usual to confirm. Please check your email or "My Bookings" section later for updates.'),u(!1)):(o("Payment failed."),d(s.message||"Gateway Status: ".concat(s.phonePePaymentStatus||"Unknown")),u(!1)):(o("Failed to verify payment status."),d(s.message||"Could not retrieve valid payment details from server."),u(!1))}catch(e){console.error("Error checking payment status:",e),o("An error occurred while checking payment status."),d("A network or server error occurred. Please try refreshing or check back later."),u(!1)}};return n(0),()=>{p.current&&clearTimeout(p.current)}},[t,e]),(0,r.jsxs)("div",{style:{padding:"20px",textAlign:"center",fontFamily:"Arial, sans-serif",minHeight:"60vh",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center"},children:[(0,r.jsx)("h1",{style:{fontSize:"2em",marginBottom:"20px",color:"#333"},children:"Payment Status"}),(0,r.jsx)("p",{style:{fontSize:"1.2em",color:"#555",marginBottom:"15px",minHeight:"50px"},children:n}),c&&(0,r.jsx)("p",{style:{color:"#777",fontStyle:"italic"},children:"Loading details..."}),l&&(0,r.jsxs)("div",{style:{marginTop:"20px",padding:"10px",border:"1px solid #ffcccc",backgroundColor:"#fff0f0",borderRadius:"5px",color:"#cc0000"},children:[(0,r.jsx)("strong",{children:"Error Details:"})," ",l]}),!c&&(l||n.includes("still pending")||n.includes("failed"))&&(0,r.jsxs)("div",{style:{marginTop:"30px"},children:[(0,r.jsx)(i.default,{href:"/packages",style:{padding:"10px 15px",backgroundColor:"#007bff",color:"white",textDecoration:"none",borderRadius:"5px",marginRight:"10px"},children:"Go back to Packages"}),(0,r.jsx)(i.default,{href:"/user/bookings",style:{padding:"10px 15px",backgroundColor:"#6c757d",color:"white",textDecoration:"none",borderRadius:"5px"},children:"View My Bookings"})]}),!c&&n.includes("successful!")&&(0,r.jsx)("div",{style:{marginTop:"30px"},children:(0,r.jsx)(i.default,{href:"/user/bookings",style:{padding:"10px 15px",backgroundColor:"#28a745",color:"white",textDecoration:"none",borderRadius:"5px"},children:"View My Bookings"})})]})}function c(){return(0,r.jsx)(a.Suspense,{fallback:(0,r.jsxs)("div",{style:{padding:"20px",textAlign:"center",fontFamily:"Arial, sans-serif",minHeight:"60vh",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center"},children:[(0,r.jsx)("h1",{style:{fontSize:"2em",marginBottom:"20px"},children:"Loading Payment Details..."}),(0,r.jsx)("p",{style:{fontStyle:"italic",color:"#777"},children:"Please wait..."})]}),children:(0,r.jsx)(o,{})})}}},function(e){e.O(0,[2972,2971,2117,1744],function(){return e(e.s=3193)}),_N_E=e.O()}]);